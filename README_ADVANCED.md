# UAL Developer Handbook v1.0

This document provides advanced technical details for developers integrating UAL (Universal Agent Layer) into their systems.

## 1. Protocol Architecture (Protocol Layer)

UAL uses Google Protobuf for efficient serialization. The core message structure is defined in `ual.proto`.

### Key Fields

*   **Header**: Contains routing and metadata.
    *   `sender_id` / `receiver_id`: UUIDs of agents.
    *   `semantic_hash`: SHA-256 hash of the content for integrity.
    *   `is_delta`: If true, `content` only contains changes from the previous state.
*   **Content (Graph)**: The semantic payload.
    *   `nodes`: List of entities, actions, or logic units.
        *   `semantic_id`: 12-bit integer mapping to the Atlas.
        *   `embedding`: Optional vector for neural-symbolic bridging.
    *   `edges`: Relationships between nodes (e.g., `CONDITION`, `NEXT`).

### Compression Modes

1.  **Standard**: Full Protobuf with metadata (~200 bytes).
2.  **PureBinary**: Stripped metadata, remapped IDs (~30 bytes).
3.  **Raw Bitstream**: Extreme compression for satellite links (4 bytes).
    *   Format: `[Op:4b][Verb:12b][Param:16b]`

## 2. Semantic Atlas (Semantic Layer)

The Atlas is the "dictionary" of UAL. You can extend it using YAML files.

### Extension Example (`my_domain.yaml`)

```yaml
namespace: "my_domain_v1"
concepts:
  - id: 0x501
    name: "drill_start"
    type: "action"
    description: "Start the drilling operation"
    
  - id: 0x502
    name: "drill_depth"
    type: "property"
    unit: "meters"
```

Load it in Python:
```python
ual.atlas.load_namespace("my_domain.yaml")
```

## 3. UAL Compiler (DSL Layer)

UAL supports a natural language-like DSL for logic definition.

### DSL Cheat Sheet

| Pattern | Example | UAL Graph Structure |
| :--- | :--- | :--- |
| **Action** | `Drone take off` | `Action(take_off) -> Entity(Drone)` |
| **Logic** | `IF battery < 20 THEN land` | `IF -> [Cond] -> Logic(<) -> [Cons] -> Action(land)` |
| **Parallel** | `scan AND patrol` | `Action(scan) <-- [AND] --> Action(patrol)` |
| **Parameter** | `fly speed=10` | `Action(fly) --[ATTR]--> Value(10)` |

## 4. Hardware Porting Guide (Embedded Layer)

The `ual-embedded` library (C99) is designed for MCUs (ESP32, STM32, Arduino).

### Porting Steps

1.  **Include Headers**:
    ```c
    #include "ual_core.h"
    ```
2.  **Memory Management**:
    Ensure your platform supports `malloc`/`free`. If not, replace with static pools in `ual_core.c`.
3.  **Parameter Parsing**:
    Use the helper functions to extract values safely.
    ```c
    // Extract "temperature" from a received graph
    float temp = ual_get_action_param_float(graph, action_id, 0xB1, 25.0);
    ```

## 5. Visual Debugger (UAL Studio)

Use `UALVisualizer` to generate HTML previews of your logic.

```python
viz = UALVisualizer(atlas)
viz.generate_preview_html(graph, "debug.html")
```

Open `debug.html` in any browser to see the interactive topology.

---
*Generated by Trae AI for UAL Project.*
